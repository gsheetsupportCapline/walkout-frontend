# Dropdown Sets - Complete Documentation

## Table of Contents

1. [Overview](#overview)
2. [Architecture](#architecture)
3. [Database Schema](#database-schema)
4. [API Endpoints](#api-endpoints)
5. [Use Cases and Examples](#use-cases-and-examples)
6. [Frontend Integration](#frontend-integration)
7. [Best Practices](#best-practices)

---

## Overview

The Dropdown Sets system provides a flexible infrastructure for managing dropdown menus across the application. It implements an **embedded document architecture** where dropdown options are stored as subdocuments within their parent dropdown sets.

### Key Features

- **Embedded Dropdown Options**: Options are stored as subdocuments within dropdown sets (no separate collection)
- **Set-Based Organization**: All options belong to a specific dropdown set
- **Role-Based Access Control**: Admin and SuperAdmin for mutations, all authenticated users for queries
- **Bulk Operations**: Efficient batch creation, updates, and deletions within a set
- **Visibility Control**: Options can be hidden without deletion
- **Name Uniqueness**: Option names must be unique within each set (can be reused across different sets)

### Design Philosophy

The system uses **embedded documents** for simplicity and atomic operations:

- Options are stored directly in the dropdown set document
- No separate collection for dropdown options
- All CRUD operations happen within the parent set context
- Better performance for retrieving sets with their options
- Automatic cleanup when deleting a set (all options deleted together)

---

## Architecture

### Entity Relationship

```
┌──────────────────────────────────┐
│     DropdownSet Collection       │
├──────────────────────────────────┤
│ _id                              │
│ name (unique globally)           │
│ description                      │
│ isActive                         │
│ createdBy                        │
│ updatedBy                        │
│ options: [                       │
│   {                              │
│     _id (auto-generated)         │
│     name (unique within set)     │
│     visibility                   │
│     isActive                     │
│     createdAt                    │
│     updatedAt                    │
│   }                              │
│ ]                                │
└──────────────────────────────────┘
```

### Key Architectural Decisions

1. **Embedded Subdocuments**:
   - Dropdown options are embedded within dropdown sets
   - No separate collection needed
   - Mongoose automatically generates `_id` for each option subdocument
2. **Set-Scoped Uniqueness**:
   - Option names must be unique within each set
   - Same option name can exist in different sets
   - Example: "Primary Care" option can exist in multiple sets
3. **Atomic Operations**:
   - Creating/updating/deleting options modifies the parent set document
   - MongoDB guarantees atomicity at document level
4. **Automatic Cleanup**:
   - Deleting a dropdown set deletes all its options automatically
   - No orphaned option documents

---

## Database Schema

### DropdownSet Model

**Collection**: `dropdown-sets`

```javascript
{
  _id: ObjectId,
  name: {
    type: String,
    required: true,
    unique: true,  // Globally unique across all dropdown sets
    trim: true
  },
  description: {
    type: String,
    default: ""
  },
  lastOptionId: {
    type: Number,
    default: 0,
    // Counter for generating incremental IDs for options
  },
  options: [  // Embedded subdocuments
    {
      _id: ObjectId,  // Auto-generated by Mongoose
      incrementalId: {
        type: Number,
        required: true,
        // Unique within this set, never reused
      },
      name: {
        type: String,
        required: true,
        trim: true  // Must be unique within this set (enforced in controller)
      },
      visibility: {
        type: Boolean,
        default: true
      },
      isActive: {
        type: Boolean,
        default: true
      },
      createdAt: Date,
      updatedAt: Date
    }
  ],
  isActive: {
    type: Boolean,
    default: true
  },
  createdBy: {
    type: ObjectId,
    ref: "User",
    required: true
  },
  updatedBy: {
    type: ObjectId,
    ref: "User"
  },
  createdAt: Date,
  updatedAt: Date
}
```

**Indexes**:

- `name`: 1 (unique, auto-created)
- `isActive`: 1 (for filtering)

**Example Document**:

```json
{
  "_id": "6578abc123def456789012",
  "name": "Department Dropdown",
  "description": "Hospital departments",
  "lastOptionId": 3,
  "options": [
    {
      "_id": "6578abc123def456789013",
      "incrementalId": 1,
      "name": "Primary Care",
      "visibility": true,
      "isActive": true,
      "createdAt": "2024-01-15T10:30:00.000Z",
      "updatedAt": "2024-01-15T10:30:00.000Z"
    },
    {
      "_id": "6578abc123def456789014",
      "incrementalId": 2,
      "name": "Emergency Medicine",
      "visibility": true,
      "isActive": true,
      "createdAt": "2024-01-15T10:35:00.000Z",
      "updatedAt": "2024-01-15T10:35:00.000Z"
    },
    {
      "_id": "6578abc123def456789015",
      "incrementalId": 3,
      "name": "Cardiology",
      "visibility": false,
      "isActive": true,
      "createdAt": "2024-01-15T10:40:00.000Z",
      "updatedAt": "2024-01-15T14:20:00.000Z"
    }
  ],
  "isActive": true,
  "createdBy": "6578abc123def456789001",
  "updatedBy": "6578abc123def456789001",
  "createdAt": "2024-01-15T10:25:00.000Z",
  "updatedAt": "2024-01-15T14:20:00.000Z"
}
```

---

## Incremental ID System

### Purpose

Each dropdown option receives a unique **incremental ID** that is:

- **Never reused**: Even if an option is deleted, its incremental ID is never assigned to a new option
- **Sequential**: IDs increment from 1, 2, 3... within each dropdown set
- **Stable**: Perfect for frontend mapping and tracking, unlike MongoDB's `_id` which changes on recreation

### How It Works

1. **DropdownSet Counter**: Each dropdown set maintains a `lastOptionId` counter (starts at 0)
2. **Auto-Increment**: When creating an option, the counter increments: `lastOptionId += 1`
3. **Assignment**: The new value becomes the option's `incrementalId`
4. **Persistence**: The counter never decreases, even after deletions

### Schema Fields

```javascript
DropdownSet: {
  lastOptionId: {
    type: Number,
    default: 0,
    // Counter for generating incremental IDs
  }
}

DropdownOption (subdocument): {
  incrementalId: {
    type: Number,
    required: true,
    // Unique within the parent dropdown set
  }
}
```

### Example Flow

```javascript
// Initial state
DropdownSet: { lastOptionId: 0, options: [] }

// Create option "Primary Care"
lastOptionId: 0 → 1
Option: { incrementalId: 1, name: "Primary Care" }

// Create option "Emergency"
lastOptionId: 1 → 2
Option: { incrementalId: 2, name: "Emergency" }

// Create option "Cardiology"
lastOptionId: 2 → 3
Option: { incrementalId: 3, name: "Cardiology" }

// Delete option "Emergency" (incrementalId: 2)
lastOptionId: stays at 3 (never decreases)
Options: [{ incrementalId: 1 }, { incrementalId: 3 }]

// Create new option "Neurology"
lastOptionId: 3 → 4
Option: { incrementalId: 4, name: "Neurology" }
// Note: incrementalId 2 is never reused!
```

### Benefits for Frontend

```javascript
// Frontend can safely map by incrementalId
const optionMapping = {
  1: "Primary Care",
  3: "Cardiology",
  4: "Neurology",
  // ID 2 permanently retired
};

// When option name changes, incrementalId remains the same
// Frontend updates automatically without remapping
```

---

## Archive System

### Purpose

Instead of permanently deleting dropdown sets or options, the system **archives** them to:

- **Preserve History**: Keep a record of all deleted items
- **Audit Trail**: Track who deleted what and when
- **Potential Recovery**: Ability to restore archived items (future feature)
- **Compliance**: Meet data retention requirements

### Archive Collection

**Collection**: `archive-dropdowns`

```javascript
ArchiveDropdown: {
  originalId: ObjectId,        // Original DropdownSet _id
  name: String,
  description: String,
  lastOptionId: Number,
  options: [                   // Archived option subdocuments
    {
      incrementalId: Number,
      name: String,
      visibility: Boolean,
      isActive: Boolean,
      originalId: ObjectId,    // Original option _id
      createdAt: Date,
      updatedAt: Date
    }
  ],
  isActive: Boolean,
  createdBy: ObjectId,
  updatedBy: ObjectId,

  // Deletion metadata
  deletedBy: ObjectId,         // Who deleted it
  deletedAt: Date,             // When it was deleted
  deletionReason: String,      // Why it was deleted (optional)

  // Original timestamps
  originalCreatedAt: Date,
  originalUpdatedAt: Date
}
```

### How It Works

#### Deleting a Dropdown Set

1. **Archive Creation**: Copy entire dropdown set to archive collection with deletion metadata
2. **Deletion**: Remove from main `dropdown-sets` collection
3. **Result**: Users can't see it, but data is preserved in archive

```javascript
// Before deletion
DropdownSet: { _id: "abc123", name: "Department Dropdown", options: [...] }

// After deletion
// Main collection: (deleted)
// Archive collection:
ArchiveDropdown: {
  originalId: "abc123",
  name: "Department Dropdown",
  options: [...],
  deletedBy: "user_id",
  deletedAt: "2024-12-20T10:00:00Z",
  deletionReason: "Manual deletion"
}
```

#### Deleting Individual Option

1. **Archive Creation**: Create archive entry with parent set info + only the deleted option
2. **Deletion**: Remove option subdocument from dropdown set
3. **Result**: Option archived, set remains active with other options

```javascript
// Deleting option "Emergency" from set "Department Dropdown"
ArchiveDropdown: {
  originalId: "set_abc123",           // Parent set ID
  name: "Department Dropdown - Option: Emergency",
  description: "Archived individual option from set: Department Dropdown",
  options: [
    {
      incrementalId: 2,
      name: "Emergency",
      originalId: "option_xyz789"      // Original option _id
    }
  ],
  deletedBy: "user_id",
  deletedAt: "2024-12-20T10:00:00Z",
  deletionReason: "Individual option deletion"
}
```

### Deletion Reason (Optional)

You can provide a deletion reason in the request body:

```json
DELETE /api/dropdowns/dropdown-sets/:id
{
  "deletionReason": "Department closed"
}
```

If not provided, defaults to "Manual deletion".

### Archive Queries (Future Feature)

Archive collections are indexed for efficient querying:

- By `originalId`: Find all archives for a specific set
- By `deletedBy`: See what a user deleted
- By `deletedAt`: Time-based queries
- By `name`: Search archived items

---

## API Endpoints

### Base URL

All dropdown endpoints are prefixed with: `/api/dropdowns`

### Authentication

All endpoints require JWT authentication via the `Authorization: Bearer <token>` header.

### Permission Levels

- **All Authenticated Users**: GET requests (read-only)
- **Admin & SuperAdmin**: POST, PUT, DELETE requests (mutations)

---

## 1. Dropdown Set Endpoints

### 1.1 Create Dropdown Set

**Endpoint**: `POST /api/dropdowns/dropdown-sets`

**Access**: Admin, SuperAdmin

**Description**: Creates a new dropdown set with an empty options array.

**Request Body**:

```json
{
  "name": "Department Dropdown",
  "description": "Hospital departments",
  "isActive": true
}
```

**Response** (201):

```json
{
  "success": true,
  "data": {
    "_id": "6578abc123def456789012",
    "name": "Department Dropdown",
    "description": "Hospital departments",
    "options": [],
    "isActive": true,
    "createdBy": {
      "_id": "6578abc123def456789001",
      "name": "Admin User",
      "email": "admin@example.com"
    },
    "createdAt": "2024-01-15T10:25:00.000Z",
    "updatedAt": "2024-01-15T10:25:00.000Z"
  }
}
```

**Error Responses**:

- `400`: Missing required field (name)
- `400`: Duplicate set name
- `401`: Unauthorized
- `403`: Forbidden

---

### 1.2 Get All Dropdown Sets

**Endpoint**: `GET /api/dropdowns/dropdown-sets`

**Access**: All authenticated users

**Query Parameters**:

- `isActive` (optional): Filter by active status (true/false)
- `limit` (optional): Number of results per page (default: 10)
- `skip` (optional): Number of results to skip (default: 0)

**Example Request**:

```
GET /api/dropdowns/dropdown-sets?isActive=true&limit=20&skip=0
```

**Response** (200):

```json
{
  "success": true,
  "count": 2,
  "data": [
    {
      "_id": "6578abc123def456789012",
      "name": "Department Dropdown",
      "description": "Hospital departments",
      "options": [
        {
          "_id": "6578abc123def456789013",
          "name": "Primary Care",
          "visibility": true,
          "isActive": true
        },
        {
          "_id": "6578abc123def456789014",
          "name": "Emergency Medicine",
          "visibility": true,
          "isActive": true
        }
      ],
      "isActive": true,
      "createdBy": {
        "_id": "6578abc123def456789001",
        "name": "Admin User"
      },
      "createdAt": "2024-01-15T10:25:00.000Z",
      "updatedAt": "2024-01-15T14:20:00.000Z"
    }
  ]
}
```

---

### 1.3 Get Dropdown Set by ID

**Endpoint**: `GET /api/dropdowns/dropdown-sets/:id`

**Access**: All authenticated users

**Response** (200):

```json
{
  "success": true,
  "data": {
    "_id": "6578abc123def456789012",
    "name": "Department Dropdown",
    "description": "Hospital departments",
    "options": [
      {
        "_id": "6578abc123def456789013",
        "name": "Primary Care",
        "visibility": true,
        "isActive": true,
        "createdAt": "2024-01-15T10:30:00.000Z",
        "updatedAt": "2024-01-15T10:30:00.000Z"
      }
    ],
    "isActive": true,
    "createdBy": {
      "_id": "6578abc123def456789001",
      "name": "Admin User",
      "email": "admin@example.com"
    },
    "createdAt": "2024-01-15T10:25:00.000Z",
    "updatedAt": "2024-01-15T14:20:00.000Z"
  }
}
```

---

### 1.4 Update Dropdown Set

**Endpoint**: `PUT /api/dropdowns/dropdown-sets/:id`

**Access**: Admin, SuperAdmin

**Description**: Updates dropdown set properties (name, description, isActive). Does not modify options - use option-specific endpoints for that.

**Request Body** (all fields optional):

```json
{
  "name": "Department Dropdown Updated",
  "description": "Updated description",
  "isActive": false
}
```

**Response** (200):

```json
{
  "success": true,
  "data": {
    "_id": "6578abc123def456789012",
    "name": "Department Dropdown Updated",
    "description": "Updated description",
    "options": [...],
    "isActive": false,
    "updatedBy": {
      "_id": "6578abc123def456789002",
      "name": "SuperAdmin User"
    },
    "updatedAt": "2024-01-15T15:45:00.000Z"
  }
}
```

---

### 1.5 Delete Dropdown Set

**Endpoint**: `DELETE /api/dropdowns/dropdown-sets/:id`

**Access**: Admin, SuperAdmin

**Description**: Permanently deletes a dropdown set and all its embedded options.

**Response** (200):

```json
{
  "success": true,
  "message": "Dropdown set deleted successfully"
}
```

---

## 2. Dropdown Option Endpoints (Embedded)

### 2.1 Create Dropdown Option

**Endpoint**: `POST /api/dropdowns/dropdown-sets/:dropdownSetId/options`

**Access**: Admin, SuperAdmin

**Description**: Creates a new dropdown option within a specific dropdown set.

**Request Body**:

```json
{
  "name": "Cardiology",
  "visibility": true,
  "isActive": true
}
```

**Response** (201):

```json
{
  "success": true,
  "data": {
    "_id": "6578abc123def456789012",
    "name": "Department Dropdown",
    "options": [
      {
        "_id": "6578abc123def456789015",
        "name": "Cardiology",
        "visibility": true,
        "isActive": true,
        "createdAt": "2024-01-15T16:00:00.000Z",
        "updatedAt": "2024-01-15T16:00:00.000Z"
      }
    ],
    "updatedBy": {
      "_id": "6578abc123def456789001",
      "name": "Admin User"
    },
    "updatedAt": "2024-01-15T16:00:00.000Z"
  }
}
```

**Error Responses**:

- `400`: Missing option name
- `400`: Duplicate option name within the set
- `404`: Dropdown set not found

---

### 2.2 Get All Options in Set

**Endpoint**: `GET /api/dropdowns/dropdown-sets/:dropdownSetId/options`

**Access**: All authenticated users

**Query Parameters**:

- `isActive` (optional): Filter by active status
- `visibility` (optional): Filter by visibility

**Example Request**:

```
GET /api/dropdowns/dropdown-sets/6578abc123def456789012/options?isActive=true&visibility=true
```

**Response** (200):

```json
{
  "success": true,
  "count": 3,
  "data": [
    {
      "_id": "6578abc123def456789013",
      "name": "Primary Care",
      "visibility": true,
      "isActive": true,
      "createdAt": "2024-01-15T10:30:00.000Z",
      "updatedAt": "2024-01-15T10:30:00.000Z"
    },
    {
      "_id": "6578abc123def456789014",
      "name": "Emergency Medicine",
      "visibility": true,
      "isActive": true,
      "createdAt": "2024-01-15T10:35:00.000Z",
      "updatedAt": "2024-01-15T10:35:00.000Z"
    }
  ]
}
```

---

### 2.3 Get Option by ID

**Endpoint**: `GET /api/dropdowns/dropdown-sets/:dropdownSetId/options/:optionId`

**Access**: All authenticated users

**Response** (200):

```json
{
  "success": true,
  "data": {
    "_id": "6578abc123def456789013",
    "name": "Primary Care",
    "visibility": true,
    "isActive": true,
    "createdAt": "2024-01-15T10:30:00.000Z",
    "updatedAt": "2024-01-15T10:30:00.000Z"
  }
}
```

---

### 2.4 Update Dropdown Option

**Endpoint**: `PUT /api/dropdowns/dropdown-sets/:dropdownSetId/options/:optionId`

**Access**: Admin, SuperAdmin

**Request Body** (all fields optional):

```json
{
  "name": "Primary Care Department",
  "visibility": false,
  "isActive": true
}
```

**Response** (200):

```json
{
  "success": true,
  "data": {
    "_id": "6578abc123def456789012",
    "name": "Department Dropdown",
    "options": [
      {
        "_id": "6578abc123def456789013",
        "name": "Primary Care Department",
        "visibility": false,
        "isActive": true,
        "updatedAt": "2024-01-15T17:00:00.000Z"
      }
    ],
    "updatedBy": {
      "_id": "6578abc123def456789001",
      "name": "Admin User"
    }
  }
}
```

---

### 2.5 Delete Dropdown Option

**Endpoint**: `DELETE /api/dropdowns/dropdown-sets/:dropdownSetId/options/:optionId`

**Access**: Admin, SuperAdmin

**Response** (200):

```json
{
  "success": true,
  "message": "Option deleted successfully"
}
```

---

## 3. Bulk Operations

### 3.1 Bulk Create Options

**Endpoint**: `POST /api/dropdowns/dropdown-sets/:dropdownSetId/options/bulk`

**Access**: Admin, SuperAdmin

**Request Body**:

```json
{
  "options": [
    {
      "name": "Cardiology",
      "visibility": true,
      "isActive": true
    },
    {
      "name": "Neurology",
      "visibility": true,
      "isActive": true
    },
    {
      "name": "Orthopedics",
      "visibility": true,
      "isActive": true
    }
  ]
}
```

**Response** (201):

```json
{
  "success": true,
  "created": 3,
  "failed": 0,
  "data": {
    "_id": "6578abc123def456789012",
    "name": "Department Dropdown",
    "options": [
      {
        "_id": "6578abc123def456789013",
        "name": "Cardiology",
        "visibility": true,
        "isActive": true
      },
      {
        "_id": "6578abc123def456789014",
        "name": "Neurology",
        "visibility": true,
        "isActive": true
      },
      {
        "_id": "6578abc123def456789015",
        "name": "Orthopedics",
        "visibility": true,
        "isActive": true
      }
    ]
  },
  "errors": []
}
```

**Partial Success Example**:

```json
{
  "success": true,
  "created": 2,
  "failed": 1,
  "data": {...},
  "errors": [
    {
      "option": {
        "name": "Cardiology",
        "visibility": true,
        "isActive": true
      },
      "error": "Option with name 'Cardiology' already exists in this set"
    }
  ]
}
```

---

### 3.2 Bulk Update Options

**Endpoint**: `PUT /api/dropdowns/dropdown-sets/:dropdownSetId/options/bulk`

**Access**: Admin, SuperAdmin

**Request Body**:

```json
{
  "updates": [
    {
      "id": "6578abc123def456789013",
      "name": "Cardiology Department",
      "visibility": true
    },
    {
      "id": "6578abc123def456789014",
      "isActive": false
    }
  ]
}
```

**Response** (200):

```json
{
  "success": true,
  "updated": 2,
  "failed": 0,
  "data": {
    "_id": "6578abc123def456789012",
    "name": "Department Dropdown",
    "options": [...]
  },
  "errors": []
}
```

---

### 3.3 Bulk Delete Options

**Endpoint**: `DELETE /api/dropdowns/dropdown-sets/:dropdownSetId/options/bulk`

**Access**: Admin, SuperAdmin

**Request Body**:

```json
{
  "ids": ["6578abc123def456789013", "6578abc123def456789014"]
}
```

**Response** (200):

```json
{
  "success": true,
  "deleted": 2,
  "failed": 0,
  "message": "2 options deleted successfully",
  "errors": []
}
```

---

## Use Cases and Examples

### Use Case 1: Creating a Department Dropdown

**Step 1**: Create the dropdown set

```bash
POST /api/dropdowns/dropdown-sets
{
  "name": "Department Dropdown",
  "description": "Hospital departments"
}
```

**Step 2**: Add options to the set (bulk create)

```bash
POST /api/dropdowns/dropdown-sets/:dropdownSetId/options/bulk
{
  "options": [
    {"name": "Primary Care", "visibility": true, "isActive": true},
    {"name": "Emergency Medicine", "visibility": true, "isActive": true},
    {"name": "Cardiology", "visibility": true, "isActive": true},
    {"name": "Neurology", "visibility": true, "isActive": true}
  ]
}
```

**Result**: Dropdown set created with 4 options embedded

---

### Use Case 2: Temporarily Hiding an Option

**Scenario**: "Emergency Medicine" department is temporarily closed.

```bash
PUT /api/dropdowns/dropdown-sets/:dropdownSetId/options/:optionId
{
  "visibility": false
}
```

**Result**: Option remains in the set but hidden from users when filtering by `visibility: true`

---

### Use Case 3: Reusing Option Names Across Different Sets

**Scenario**: Need "Active/Inactive" options in multiple dropdowns.

```bash
# Set 1: Patient Status
POST /api/dropdowns/dropdown-sets
{"name": "Patient Status"}

POST /api/dropdowns/dropdown-sets/:setId1/options/bulk
{"options": [{"name": "Active"}, {"name": "Inactive"}]}

# Set 2: Treatment Status
POST /api/dropdowns/dropdown-sets
{"name": "Treatment Status"}

POST /api/dropdowns/dropdown-sets/:setId2/options/bulk
{"options": [{"name": "Active"}, {"name": "Inactive"}]}
```

**Result**: "Active" and "Inactive" options exist in both sets independently

---

## Frontend Integration

### React Example: Fetching and Displaying Dropdown

```javascript
import React, { useState, useEffect } from "react";
import axios from "axios";

const DropdownSet = ({ dropdownSetId }) => {
  const [dropdownSet, setDropdownSet] = useState(null);
  const [selectedOption, setSelectedOption] = useState("");
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchDropdownSet = async () => {
      try {
        const token = localStorage.getItem("authToken");
        const response = await axios.get(
          `http://localhost:5000/api/dropdowns/dropdown-sets/${dropdownSetId}`,
          {
            headers: { Authorization: `Bearer ${token}` },
          }
        );

        setDropdownSet(response.data.data);
        setLoading(false);
      } catch (error) {
        console.error("Failed to load dropdown set:", error);
        setLoading(false);
      }
    };

    fetchDropdownSet();
  }, [dropdownSetId]);

  if (loading) return <div>Loading...</div>;
  if (!dropdownSet) return null;

  // Filter visible and active options
  const visibleOptions = dropdownSet.options.filter(
    (opt) => opt.visibility && opt.isActive
  );

  return (
    <div className="dropdown-container">
      <label htmlFor="dropdown-select">{dropdownSet.name}</label>
      {dropdownSet.description && <p>{dropdownSet.description}</p>}

      <select
        id="dropdown-select"
        value={selectedOption}
        onChange={(e) => setSelectedOption(e.target.value)}
        disabled={!dropdownSet.isActive}
      >
        <option value="">-- Select Option --</option>
        {visibleOptions.map((option) => (
          <option key={option._id} value={option._id}>
            {option.name}
          </option>
        ))}
      </select>
    </div>
  );
};

export default DropdownSet;
```

---

## Best Practices

### 1. Option Naming

- Use clear, descriptive names
- Keep names concise (under 50 characters)
- Use consistent capitalization
- Examples: "Primary Care", "Emergency Medicine", "Cardiology"

### 2. Set Organization

- Create separate sets for different contexts
- Example: "Department Dropdown" vs "Specialty Dropdown"
- Don't mix unrelated options in one set

### 3. Visibility vs Deletion

- **Use `visibility: false`** for temporary hiding (data preserved)
- **Use DELETE** only when option will never be used again
- Visibility allows easy restoration

### 4. Performance

- Dropdown sets load all embedded options in one query (efficient)
- Use pagination when fetching multiple sets
- Filter by `isActive` and `visibility` on frontend

### 5. Uniqueness

- Option names must be unique **within each set**
- Same name can exist across different sets
- Set names must be globally unique

---

## Troubleshooting

**Issue**: Can't create option with existing name

**Solution**: Check if option name already exists in that specific set. Same name is allowed in different sets.

---

**Issue**: Deleted dropdown set but need to restore options

**Solution**: Embedded documents are deleted with parent. Always backup before deleting sets. Consider using `isActive: false` instead of deletion.

---

**Issue**: Can't find option by ID

**Solution**: Option IDs are scoped to their parent set. Always provide both `dropdownSetId` and `optionId` in requests.

---

## API Summary

| Endpoint                                       | Method | Access     | Description            |
| ---------------------------------------------- | ------ | ---------- | ---------------------- |
| `/dropdown-sets`                               | POST   | Admin      | Create dropdown set    |
| `/dropdown-sets`                               | GET    | All        | Get all sets           |
| `/dropdown-sets/:id`                           | GET    | All        | Get set by ID          |
| `/dropdown-sets/:id`                           | PUT    | Admin      | Update set             |
| `/dropdown-sets/:id`                           | DELETE | Admin      | Delete set             |
| `/dropdown-sets/:setId/options`                | POST   | Admin      | Create option          |
| `/dropdown-sets/:setId/options`                | GET    | All        | Get all options        |
| `/dropdown-sets/:setId/options/:optId`         | GET    | All        | Get option by ID       |
| `/dropdown-sets/:setId/options/:optId`         | PUT    | Admin      | Update option          |
| `/dropdown-sets/:setId/options/:optId`         | DELETE | Admin      | Delete option          |
| `/dropdown-sets/:setId/options/bulk`           | POST   | Admin      | Bulk create            |
| `/dropdown-sets/:setId/options/bulk`           | PUT    | Admin      | Bulk update            |
| `/dropdown-sets/:setId/options/bulk`           | DELETE | Admin      | Bulk delete            |
| `/archives/dropdown-sets`                      | GET    | SuperAdmin | Get archived sets      |
| `/archives/dropdown-sets/:id`                  | GET    | SuperAdmin | Get archived set by ID |
| `/archives/dropdown-sets/:archiveId/restore`   | POST   | SuperAdmin | Restore archived set   |
| `/archives/dropdown-sets/:archiveId/permanent` | DELETE | SuperAdmin | Permanently delete     |

---

## Restore Operations (SuperAdmin Only)

### View Archived Dropdown Sets

**Endpoint**: `GET /api/dropdowns/archives/dropdown-sets`

**Access**: SuperAdmin only

**Query Parameters**:

- `deletedBy`: Filter by user who deleted (ObjectId)
- `limit`: Number of results (default: 20)
- `skip`: Pagination offset (default: 0)
- `sortBy`: Sort field (default: "-deletedAt")

**Response** (200):

```json
{
  "success": true,
  "count": 2,
  "total": 5,
  "data": [
    {
      "_id": "archive123",
      "originalId": "6578abc123def456789012",
      "name": "Payment Methods",
      "description": "Select payment method",
      "lastOptionId": 3,
      "options": [
        {
          "originalId": "opt001",
          "incrementalId": 1,
          "name": "Cash",
          "visibility": true,
          "isActive": true
        }
      ],
      "deletedBy": {
        "_id": "user123",
        "name": "Admin User",
        "email": "admin@example.com"
      },
      "deletedAt": "2024-01-20T10:00:00.000Z",
      "deletionReason": "Accidentally deleted"
    }
  ]
}
```

---

### Get Archived Dropdown Set by ID

**Endpoint**: `GET /api/dropdowns/archives/dropdown-sets/:id`

**Access**: SuperAdmin only

**Response** (200):

```json
{
  "success": true,
  "data": {
    "_id": "archive123",
    "originalId": "6578abc123def456789012",
    "name": "Payment Methods",
    "options": [...],
    "deletedBy": {...},
    "deletedAt": "2024-01-20T10:00:00.000Z",
    "originalCreatedAt": "2024-01-15T10:00:00.000Z"
  }
}
```

---

### Restore Archived Dropdown Set

**Endpoint**: `POST /api/dropdowns/archives/dropdown-sets/:archiveId/restore`

**Access**: SuperAdmin only

**Request Body** (optional):

```json
{
  "newName": "Payment Methods (Restored)" // Optional: rename if original name exists
}
```

**Response** (200):

```json
{
  "success": true,
  "message": "Dropdown set restored successfully",
  "data": {
    "_id": "new_id_123",
    "name": "Payment Methods (Restored)",
    "lastOptionId": 3,
    "options": [
      {
        "_id": "new_opt_id",
        "incrementalId": 1,
        "name": "Cash",
        "visibility": true,
        "isActive": true
      }
    ],
    "createdBy": {...},
    "updatedBy": {...}  // User who performed restore
  }
}
```

**Error Response** (400) - Name Conflict:

```json
{
  "success": false,
  "message": "Dropdown set with name 'Payment Methods' already exists. Please rename the existing set first or provide a new name."
}
```

---

### Permanently Delete Archived Set

**Endpoint**: `DELETE /api/dropdowns/archives/dropdown-sets/:archiveId/permanent`

**Access**: SuperAdmin only

**Response** (200):

```json
{
  "success": true,
  "message": "Archived dropdown set permanently deleted"
}
```

---

**Last Updated**: December 2024
**Version**: 2.1.0 (With Restore Operations)
**Maintained By**: Walkout Backend Team
